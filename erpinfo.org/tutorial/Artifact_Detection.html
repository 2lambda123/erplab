<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Artifact Detection</title>

<link href="styles/erplab.css" rel="stylesheet" type="text/css" />
<style type="text/css">
<!--
p.paragraph {
margin-top:0in;
margin-right:0in;
margin-bottom:8.0pt;
margin-left:0in;
font-size:11.0pt;
font-family:Cambria;
}
-->
</style>
<style type="text/css">
<!--
p.MsoNormal {
margin:0in;
margin-bottom:.0001pt;
font-size:12.0pt;
font-family:Cambria;
}
-->
</style>
<style type="text/css">
<!--
p.LiteralText {
margin:0in;
margin-bottom:.0001pt;
font-size:10.0pt;
font-family:Helvetica;
}
-->
</style>
<style type="text/css">
<!--
table.MsoNormalTable {
font-size:10.0pt;
font-family:Cambria;
}
-->
</style>
<style type="text/css">
<!--
p.CommandWindowText {
margin:0in;
margin-bottom:.0001pt;
text-align:justify;
font-size:9.0pt;
font-family:Courier;
}
-->
</style>
</head>

<body>
<p class="paragraph">The next step after epoching is usually artifact detection.  ERPLAB makes a distinction between <em>artifact detection</em> and <em>artifact rejection</em>.  Artifact detection is the process of marking epochs that contain artifacts.  Artifact rejection is the process of excluding trials containing artifacts.  The ERPLAB artifact detection routines do not throw out any data; epochs with artifacts are merely marked.  Artifact rejection occurs during averaging; marked epochs are simply excluded from the averaging process.</p>
<h2 style="margin-left:.55in;text-indent:-.55in;">Example 1: Moving window peak-to-peak threshold</h2>
<p class="paragraph">We will start with moving window peak-to-peak threshold. Make sure that your epoched dataset is active (&quot;S1_EEG_elist_be&quot;) and select <strong>ERPLAB &gt; Artifact Detection &gt; Moving window peak-to-peak threshold</strong>.  You will see the window shown in the screenshot below.</p>
<p class="paragraph"><img src="images/moving_window.jpg" alt="moving_window" width="360" height="473" /></p>
<p class="paragraph">This routine finds the maximum peak-to-peak voltage within a moving window that slides across the epoch (see the ERPLAB User's Manual for details).  You select the <strong>Test period,</strong> which is by default the entire epoch (note that the time values you selected in the epoching process have been rounded to actual sample times).  However, sometimes you will want to search for artifacts only during a portion of the epoch.  You cannot, of course, look for artifacts outside of the epoch period, because only the data from within the epoch period are present after the data have been epoched.</p>
<p class="paragraph">You must also choose a <strong>Voltage threshold</strong>.  An epoch will be rejected if the peak-to-peak voltage (the difference between the largest and smallest values) exceeds this value.  The appropriate value will depend on the nature of the artifact you are trying to reject and how large it is in a given subject (see Chapter 4 in <em>An Introduction to the Event-Related Potential Technique</em> for an overview of artifact detection).</p>
<p class="paragraph">You will then choose the length of the <strong>Moving window</strong> and the <strong>Window step</strong>.  This routine finds the peak-to-peak voltage within a window of the length specified in the <strong>Moving window</strong> field.  It then shifts the window by the amount specified in the <strong>Window step</strong> field and finds the peak-to-peak voltage within this new window.  This is repeated until the end of the <strong>Test period</strong>, and the largest of these peak-to-peak amplitudes is compared with the <strong>Voltage threshold</strong>.  This is an excellent way to find artifacts in which the voltage changes rapidly within a relatively short period of time (e.g., blinks, which usually peak and then subside within 200-300 ms) and not be fooled by relatively slow voltage changes.</p>
<p class="paragraph">By default, artifacts will be detected in all channels.  However, you can specify a subset of channels to be tested in the <strong>Channel(s)</strong> field.</p>
<p class="paragraph"><em>Hint: Most windows that ask you to specify a range of values allow you to use the standard Matlab rules for numeric lists.  You can simply type the values separated by spaces (e.g., &quot;1 2 3&quot;), or you can use a colon to specify a range (e.g., &quot;1:3&quot;) or some combination (e.g., &quot;1:3 5:7&quot; to indicate 1-3 and 5-7).  To specify a regular set of values, you can specify the first value, the step size, and the last value (e.g., &quot;1:3:7&quot; to start with 1 and go by steps of 3 to a final value of 7 [1 4 7]).</em></p>
<p class="paragraph">Finally, you can specify a set of flags in the <strong>Flag</strong> field that will be set in the EventList whenever an epoch has been marked for rejection.  This allows you to do things like perform behavioral analyses on the information in the EventList while excluding events that contain artifacts.  Flag 1 is always set for events with artifacts, and you can keep track of which events had which types of artifacts by setting additional flags for each artifact rejection test you perform.  For details, see the ERPLAB User's Manual. </p>
<p class="paragraph">Once you have set all of the fields as shown in the screenshot above, click <strong>Accept</strong>.  After scanning the active dataset for artifacts (which may take some time), the total percentage of trials with artifacts detected will be shown in the Matlab command window (this is the total percentage marked for rejection, including epochs that had been marked previously).  It should look like this:</p>
<p class="LiteralText">pop_artmwppth() rejected a 29.7 % of total trials.</p>
<p class="LiteralText">&nbsp;</p>
<p class="paragraph">At this point, the ERPLAB artifact rejection routines automatically bring up the scrolling EEG data viewer window, as shown in the screenshot below.  You should scroll through the data to make sure that the parameters you entered have actually caused epochs containing artifacts to be detected without accidentally marking a large number of epochs without true artifacts.  For example, you may need to increase the threshold if epochs without real artifacts are being marked for rejection, and you may need to decrease the threshold if epochs with clear artifacts are not being marked.  Each epoch that has been marked is shown with a yellow background, and the channels within the epoch that exceeded the rejection threshold are drawn in red (see screenshot below).  At present, artifact rejection is all-or-none; the entire epoch is discarded if an artifact is detected in one or more channels in that epoch.</p>
<p><img src="images/eeg6.jpg" alt="eeg6" width="653" height="445" /></p>
<p class="paragraph">The window for saving the newly created dataset is also brought up at this point.  The idea is that you will scan through the dataset, and either save it (if everything looks OK) or click on <strong>CANCEL</strong> (if you want to change the parameters and try again). Once you have finished looking at the data, click <strong>Ok</strong> in the window for saving the dataset if you are satisfied with the artifacts that were detected (it will be named &quot;S1_EEG_elist_be_ar&quot;). </p>
<div style="border:double windowtext 3.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;">
  <p class="paragraph" style="border:none;padding:0in;"><strong><span style="font-size:12.0pt; ">Equivalent Script Command:</span></strong></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Artifact Detection with Moving window peak to peak threshold</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Test period [-200 798]. Voltage threshold 100uV</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Moving window width: 200 ms. Window step: 50. Channels 1:16</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Mark flags 1 and 4 (you must always mark flag 1</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;">EEG = pop_artmwppth( EEG, <span id="#A020F0">'Channel'</span>, 1:16, 'Flag', [1 2]. 'Threshold', 100, 'Twindow', [-200  798],'Windowsize',... 200, ' Windowstep', 50); </p>
<p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%The script-based routine does not show you the data.  To see the data, do this:</span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; ">pop_eegplot(EEG);</span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Now we will save the dataset</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Setname is S1_EEG_elist_be_ar</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Filename is S1_EEG_elist_be_ar.set</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Path is /Users/etfoo/Desktop/tutorial_script/</span><span style="font-size:11.0pt; color:forestgreen; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Note that you will need to replace the path with the actual location in your file system</span><span style="font-size:11.0pt; color:forestgreen; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">EEG.setname=</span><span style="font-size:11.0pt; color:#A020F0; ">'S1_EEG_elist_be_ar'</span><span style="font-size:11.0pt; color:black; ">; </span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">EEG=pop_saveset(EEG, </span><span style="font-size:11.0pt; color:#A020F0; ">'filename'</span><span style="font-size:11.0pt; color:black; ">, </span><span style="font-size:11.0pt; color:#A020F0; ">'S1_EEG_elist_be_ar.set'</span><span style="font-size:11.0pt; color:black; ">, </span><span style="font-size:11.0pt; color:#A020F0; ">'filepath'</span><span style="font-size:11.0pt; color:black; ">,</span><span style="font-size:11.0pt; color:blue; ">...</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">    </span><span style="font-size:11.0pt; color:#A020F0; ">'/Users/etfoo/Desktop/tutorial_script/'</span><span style="font-size:11.0pt; color:black; ">);</span><span style="font-size:11.0pt; color:black; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%The following command uses Matlab's <em>Current Folder</em></span><em><span style="font-size:11.0pt; color:forestgreen; "> </span></em></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">EEG.setname=</span><span style="font-size:11.0pt; color:#A020F0; ">'S1_EEG_elist_be_ar'</span><span style="font-size:11.0pt; color:black; ">; </span><span style="font-size:11.0pt; color:black; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; ">EEG=pop_saveset(EEG,<span style="color:#A020F0; "> 'filename', 'S1_EEG_elist_be_ar.set')</span>;</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; ">&nbsp;</span></p>
</div>
<p class="paragraph">&nbsp;</p>
<p class="paragraph">Note that the scrolling EEG display window ordinarily allows you to click on an epoch that has not been marked to manually mark it or to click on an epoch that has already been marked to unmark it.  However, this ability is disabled when you are looking at the initial results of an artifact detection procedure, because the goal at this moment is to determine whether the automated procedure worked correctly. Once you are satisfied and have saved the dataset, you can open it again in the scrolling EEG display window, and then you can manually reject and unreject epochs.  </p>
<h2 style="margin-left:.55in;text-indent:-.55in;">Seeing a summary of the number of artifacts detected</h2>
<p class="paragraph">If, at some later time, you want to see how many trials have been marked for rejection in a given dataset, you can select <strong>ERPLAB &gt; Artifact Detection &gt; EEG Artifact Detection Summary Table</strong>.  This will print a table of the number of trials marked for rejection in each bin, along with the number of occurrences of each flag (which ordinarily corresponds to different types of artifacts).   In our example, it should look like this if you print the table in the command window:</p>
<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0" width="464" style="margin-left:4.65pt;border-collapse:collapse;">
  <tr style="height:15.0pt;">
    <td width="40" nowrap="nowrap" valign="bottom" style="width:65.0pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">Bin   </span></p></td>
    <td width="65" nowrap="nowrap" valign="bottom" style="width:65.0pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" style="margin-bottom:.0001pt;"><span style="font-family:Calibri; color:black; ">#(%) accepted</span></p></td>
    <td width="65" nowrap="nowrap" valign="bottom" style="width:65.0pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" style="margin-bottom:.0001pt;"><span style="font-family:Calibri; color:black; ">#(%) rejected</span></p></td>
    <td width="40" nowrap="nowrap" valign="bottom" style="width:39.75pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; "># F2</span></p></td>
    <td width="36" nowrap="nowrap" valign="bottom" style="width:.5in;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; "># F3</span></p></td>
    <td width="41" nowrap="nowrap" valign="bottom" style="width:40.5pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; "># F4</span></p></td>
    <td width="41" nowrap="nowrap" valign="bottom" style="width:40.5pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; "># F5</span></p></td>
    <td width="41" nowrap="nowrap" valign="bottom" style="width:40.5pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; "># F6 </span></p></td>
    <td width="36" nowrap="nowrap" valign="bottom" style="width:.5in;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; "># F7</span></p></td>
    <td width="36" nowrap="nowrap" valign="bottom" style="width:.5in;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; "># F8</span></p></td>
  </tr>
  <tr style="height:15.0pt;">
    <td width="40" nowrap="nowrap" valign="bottom" style="width:65.0pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">1</span></p></td>
    <td width="65" nowrap="nowrap" valign="bottom" style="width:65.0pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" style="margin-bottom:.0001pt;"><span style="font-family:Calibri; color:black; ">177( 69.1)       </span></p></td>
    <td width="65" nowrap="nowrap" valign="bottom" style="width:65.0pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" style="margin-bottom:.0001pt;"><span style="font-family:Calibri; color:black; ">79( 30.9)       </span></p></td>
    <td width="40" nowrap="nowrap" valign="bottom" style="width:39.75pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
    <td width="36" nowrap="nowrap" valign="bottom" style="width:.5in;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
    <td width="41" nowrap="nowrap" valign="bottom" style="width:40.5pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">79</span></p></td>
    <td width="41" nowrap="nowrap" valign="bottom" style="width:40.5pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
    <td width="41" nowrap="nowrap" valign="bottom" style="width:40.5pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
    <td width="36" nowrap="nowrap" valign="bottom" style="width:.5in;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
    <td width="36" nowrap="nowrap" valign="bottom" style="width:.5in;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
  </tr>
  <tr style="height:15.0pt;">
    <td width="40" nowrap="nowrap" valign="bottom" style="width:65.0pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">2</span></p></td>
    <td width="65" nowrap="nowrap" valign="bottom" style="width:65.0pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" style="margin-bottom:.0001pt;"><span style="font-family:Calibri; color:black; ">48( 75.0)       </span></p></td>
    <td width="65" nowrap="nowrap" valign="bottom" style="width:65.0pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" style="margin-bottom:.0001pt;"><span style="font-family:Calibri; color:black; ">16( 25.0)       </span></p></td>
    <td width="40" nowrap="nowrap" valign="bottom" style="width:39.75pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
    <td width="36" nowrap="nowrap" valign="bottom" style="width:.5in;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
    <td width="41" nowrap="nowrap" valign="bottom" style="width:40.5pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">16</span></p></td>
    <td width="41" nowrap="nowrap" valign="bottom" style="width:40.5pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
    <td width="41" nowrap="nowrap" valign="bottom" style="width:40.5pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
    <td width="36" nowrap="nowrap" valign="bottom" style="width:.5in;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
    <td width="36" nowrap="nowrap" valign="bottom" style="width:.5in;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
  </tr>
  <tr style="height:15.0pt;">
    <td width="40" nowrap="nowrap" valign="bottom" style="width:65.0pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">Total </span></p></td>
    <td width="65" nowrap="nowrap" valign="bottom" style="width:65.0pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" style="margin-bottom:.0001pt;"><span style="font-family:Calibri; color:black; ">225( 70.3)       </span></p></td>
    <td width="65" nowrap="nowrap" valign="bottom" style="width:65.0pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" style="margin-bottom:.0001pt;"><span style="font-family:Calibri; color:black; ">95( 29.7)       </span></p></td>
    <td width="40" nowrap="nowrap" valign="bottom" style="width:39.75pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
    <td width="36" nowrap="nowrap" valign="bottom" style="width:.5in;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
    <td width="41" nowrap="nowrap" valign="bottom" style="width:40.5pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">95</span></p></td>
    <td width="41" nowrap="nowrap" valign="bottom" style="width:40.5pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
    <td width="41" nowrap="nowrap" valign="bottom" style="width:40.5pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
    <td width="36" nowrap="nowrap" valign="bottom" style="width:.5in;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
    <td width="36" nowrap="nowrap" valign="bottom" style="width:.5in;padding:0in 5.4pt 0in 5.4pt;height:15.0pt;"><p class="MsoNormal" align="right" style="margin-bottom:.0001pt;text-align:right;"><span style="font-family:Calibri; color:black; ">0</span></p></td>
  </tr>
</table>
<p class="LiteralText">&nbsp;</p>
<p class="paragraph">You can also select <strong>ERPLAB &gt; Artifact Detection &gt; EEG Artifact Detection Summary Plot</strong>, which will show the distribution of artifacts across channels.  You can also get this information after averaging with <strong>ERPLAB &gt; Artifact Detection &gt; ERP Artifact Detection Summary Table</strong>. </p>
<h2 style="margin-left:.55in;text-indent:-.55in;">Rejecting multiple times and clearing flags</h2>
<p class="paragraph">Imagine that you want to do artifact rejection twice, once on the VEOG channel with a relatively low threshold (e.g., 75 µV) and short moving window length (e.g., 200 ms) to detect blinks, and once on all the other channels with a relatively high threshold (e.g., 200 µV) and long moving window length (e.g., 1000 ms) to detect other kinds of artifacts (e.g., EMG bursts, skin potentials, etc.).  You can simply run the artifact detection routine once with one set of parameters, save the dataset, and then run the artifact detection routine on this new dataset with a new set of parameters.   Any artifacts marked in the dataset prior to artifact detection will remain marked when artifact rejection is performed on that dataset, and any additional artifacts will be marked in the new dataset.  If you wish to unmark everything and start over, you can either clear the datasets and go back to an unmarked dataset or select <strong>ERPLAB &gt; Artifact Detection &gt; Clear Artifact Detection Marks on EEG </strong>which then displays the following figure.</p>
<p><img src="images/reset_artifacts.jpg" alt="reset_artifacts" width="730" height="337" /></p>
<p class="paragraph">To reset the artifact detection marks, make sure <strong>Reset Artifact Rejection Marks</strong>, <strong>Reset Flags</strong>, and <strong>All flags</strong> are selected, then click <strong>OK</strong>. After you click <strong>OK</strong>, a window pops up prompting you to name the new dataset.</p>
<div style="border:double windowtext 3.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;">
  <p class="paragraph" style="border:none;padding:0in;"><strong><span style="font-size:12.0pt; ">Equivalent Script Command:</span></strong></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Artifact Detection, Clear Artifact Detection Marks on EEG</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">EEG = pop_resetrej(EEG, 1, 65535);</span><span style="font-size:11.0pt; "> </span></p>
</div>
<p class="paragraph">&nbsp;</p>
<h2 style="margin-left:.55in;text-indent:-.55in;">Combining EEGLAB and ERPLAB Artifact Detection</h2>
<p class="paragraph">EEGLAB allows you to manually delete sections of the continuous EEG with artifacts from within the <strong>Plot &gt; Channel data (scroll)</strong> window.  This deletion is permanent (although you can always go back to a previous version of the data in which the data have not been deleted).  Manual deletion also causes the insertion of a <strong>boundary</strong> event.  This type of artifact rejection is performed on the continuous EEG, so it is prior to (and independent of) ERPLAB's artifact detection.</p>
<p class="paragraph">EEGLAB also has routines for marking epochs for deletion (and you can optionally delete the rejected epochs from the EEG in addition to marking them).  The most useful of these routines allows you to visually inspect the data and click on epochs that you would like to mark for deletion (<strong>Tools &gt; Reject data epochs &gt; Reject by inspection</strong>).  If you use any of EEGLAB's routines for marking epochs for rejection, the marks will not automatically be propagated to the artifact flags in the EVENTLIST (because EEGLAB doesn't &quot;know&quot; anything about the EVENTLIST structure).  Similarly, any manual rejection that you do by simply changing the EVENTLIST flags won't be propagated to EEGLAB's rejection marks.  When you average the ERPs, ERPLAB's averaging routine automatically rejects trials marked in either place, and the EVENTLIST in the ERP will contain marks for both types of rejections.  In addition, you can force the synchronization of these two sets of marks with <strong>ERPLAB &gt; Artifact Detection &gt; Synchronize Artifact Info in EEG and EVENTLIST</strong>.  This can also be achieved from scripts or from the command line with the pop_syncroartifacts() routine.</p>
<h2 style="margin-left:.55in;text-indent:-.55in;">Example 2: Step-like artifacts</h2>
<p class="paragraph">To see how this works, let's take the dataset that you've already marked with rejections using the <strong>Moving window peak-to-peak threshold test</strong> and apply another test, the <strong>Step-like artifacts test</strong>.  In this example, we will attempt to detect horizontal eye movements in the HEOG channel (channel 16).  Saccadic eye movements have a distinctive shape, because the eyes are steady at one location for a period of time, then jump to another location, stay steady for a period of time, and then jump to yet another location, so the HEOG signal is relatively flat, suddenly jumps to a new level, stays flat for a period of time, and then jumps to a new level.  In many cases, the eyes are on the fixation point, jump away for a few hundred milliseconds, and then jump back to fixation.  When this happens, the HEOG signal has a boxcar shape, as in the screenshot shown below.</p>
<p class="paragraph"><img src="images/saccade.jpg" alt="saccade" width="607" height="395" /></p>
<p class="paragraph">The current data file has quite a bit of high-frequency noise that makes it difficult to see this small artifact (which was at epoch #208).  Thus, the data shown in the screenshot above were first filtered with a 30-Hz low-pass filter (see the <a href="#_Filtering_EEG_and">section on filtering</a> for more details).  To get a close-up view of the artifact, the time window to display was set to 1 epoch and the number of channels to display was set to 3 (within the <strong>Settings</strong> menu within the plotting window).</p>
<p class="paragraph">Without the filter, the plot will look like the following screenshot:</p>
<p><img src="images/saccade2.jpg" alt="saccade2" width="652" height="392" /></p>
<p class="paragraph">The <strong>Step-like artifacts</strong> function is well suited to detecting this type of artifact (see the User's Manual for more details about this function).  To use it, make sure that the dataset you created with the first artifact test is selected, and then select <strong>ERPLAB &gt; Artifact Detection &gt; Step-like artifacts</strong>.  Enter the parameters as shown in the screenshot below, making sure that Flag 3 is selected (you should have selected Flag 4 when you did the peak-to-peak detection) and that you are detecting artifacts only in Channel 16.  Note that the full width of the step function is set to 400 ms.  This means that we are looking for a period of one voltage for &gt;=200 ms immediately followed by a period of a different voltage for &gt;=200 ms.  This width was chosen because fixation periods almost always last for at least 200 ms.</p>
<p><img src="images/step.jpg" alt="step" width="297" height="385" /></p>
<p class="paragraph">After you click <strong>Accept</strong>, you will see in the command window that this routine found artifacts on 12.8% of trials.  If you look at the scrolling data window that pops up, you will see that some of the epochs with these artifacts also had blink artifacts that were detected with the peak-to-peak amplitude routine that was previously run with these data (e.g., epoch 44 indicates a rejection of the HEOG channel by drawing this channel in red, and the data from several other channels are also drawn in red from the peak-to-peak artifact detection).  However, other epochs were rejected solely because of the step function in the HEOG channel (e.g., epochs 208 and 209).</p>
<div style="border:double windowtext 3.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;">
  <p class="paragraph" style="border:none;padding:0in;"><strong><span style="font-size:12.0pt; ">Equivalent Script Command:</span></strong></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Artifact Detection, Step-like artifacts</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Test period [-200 798], Voltage Threshold 15</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Moving Window Width 400, Window step 10</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Channel 16 only, Mark flags 1 and 3 (you must always mark flag 1</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">EEG = pop_artstep( EEG,'Channel', 16, 'Flag', 1, 'Threshold' 15, 'Twindow', [-200 798], 'Windowsize', 400, 'Windowstep', 10); </span><span style="font-size:11.0pt; "> </span></p>
</div>
<p class="paragraph">&nbsp;</p>
<h2 style="margin-left:.55in;text-indent:-.55in;">Looking at artifact information in the EventList</h2>
<p class="paragraph">Information about the artifacts can also be found in the EventList.  To see this, save the EventList from the current dataset in a text file by selecting <strong>ERPLAB &gt; EventList &gt; Export EEG EventList to Text File</strong>.  Now open the text file in a text editor.  You will see something like the following.  </p>
<p class="CommandWindowText"><img src="images/elist.jpg" alt="elist" width="789" height="183" /></p>
<p class="paragraph">If you look at the column of artifact rejection flags (a_flags), you will see that every rejected trial has flag 1 set (the rightmost flag).  Some of the events have flag 4 set from the peak-to-peak routine (e.g., item 157).  Other events have flag 3 set from the step function routine (e.g., item 159), and other events have both flags 3 and 4 set (e.g., item 167), indicating that both types of artifacts were detected.  This information can be useful if you want to perform behavioral analyses excluding trials with specific types of artifacts.</p>
<div style="border:double windowtext 3.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;">
  <p class="paragraph" style="border:none;padding:0in;"><strong><span style="font-size:12.0pt; ">Equivalent Script Command:</span></strong></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Export EEG Eventlist to Text file</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Filename is Export_EEG_EL.txt</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Path is /Users/etfoo/Desktop/tutorial_script</span><span style="font-size:11.0pt; color:forestgreen; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Note that you will need to replace the path with the actual location in your file system</span><span style="font-size:11.0pt; color:forestgreen; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">EEG = pop_exporteegeventlist(EEG,</span><span style="font-size:11.0pt; color:blue; "> </span><span style="font-size:11.0pt; color:#A020F0; ">'/Users/etfoo/Desktop/tutorial_script/Export_EEG_EL.txt'</span><span style="font-size:11.0pt; color:black; ">);</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%The following command uses Matlab's <em>Current Folder</em></span><em><span style="font-size:11.0pt; color:forestgreen; "> </span></em></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">EEG = pop_exporteegeventlist(EEG,</span><span style="font-size:11.0pt; color:blue; "> </span><span style="font-size:11.0pt; color:#A020F0; ">'Export_EEG_EL.txt'</span><span style="font-size:11.0pt; color:black; ">);</span><span style="font-size:11.0pt; color:black; "> </span></p>
</div>
<p class="paragraph">&nbsp;</p>
<p class="paragraph">Note that the left column in this text file shows the original item number of the event, from the original continuous dataset.  The second column shows the bin epoch (<em>bepoch</em>) number, which is the item number after epoching.  These numbers will be different when some event codes are not used as time-locking events when the data are epoched (e.g., the response event codes in the current example).  If you are trying to find an event in the continuous data with <strong>Plot &gt; Channel data (scroll)</strong>, you should use the item number (first column).  If you are trying to find an event in the epoched data, you should use the bepoch number (second column). </p>
<p class="paragraph"><em>Note for programmers:<strong> </strong></em>The flags are shown in a binary format in the text file (to make it easier to see the individual flag values).  However, they are stored in a single variable, and Matlab ordinarily uses decimal numbers to enter and print the value of a variable. For example: If you set flags 1 and 5 in an artifact detection tool, and you print out the value of the flag variable, you will see a value of 17. </p>
<p class="paragraph">&nbsp;</p>
<p>&nbsp;</p>
<table width="100%" border="0">
  <tr>
    <td><a href="Bin_Epoch.html">&lt;&lt;Create Bin-Based Epochs</a></td>
    <td><a href="index.html">Table of Contents</a></td>
    <td><a href="Averaging.html">Averaging&gt;&gt;</a></td>
  </tr>
</table>
</body>
</html>
