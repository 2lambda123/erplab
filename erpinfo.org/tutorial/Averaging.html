<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Creating Averaged ERPs</title>

<link href="styles/erplab.css" rel="stylesheet" type="text/css" />
<style type="text/css">
<!--
p.paragraph {
margin-top:0in;
margin-right:0in;
margin-bottom:8.0pt;
margin-left:0in;
font-size:11.0pt;
font-family:Cambria;
}
-->
</style>
<style type="text/css">
<!--
table.MsoNormalTable {
font-size:11.0pt;
font-family:Cambria;
}
p.MsoNormal {
margin:0in;
margin-bottom:.0001pt;
font-size:12.0pt;
font-family:Cambria;
}
-->
</style>
</head>

<body>
<p class="paragraph">We are now (finally!) ready to create a set of averaged ERP waveforms.  First make sure that the correct dataset is active (&quot;S1_EEG_elist_be_ar&quot;, which has been epoched and scanned for artifacts with the Moving Window peak-to-peak threshold artifact detection function).  Your <strong>Datasets</strong> menu should look something like the screenshot below.</p>
<p><img src="images/datasets2.jpg" alt="datasets2" width="247" height="177" /></p>
<p class="MsoNormal" style="text-autospace:none;"><span style="font-family:Courier; color:forestgreen; ">&nbsp;</span></p>
<div style="border:double windowtext 3.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;">
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><strong>Equivalent Script Command:</strong></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-family:Courier; color:forestgreen; ">&nbsp;</span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Load S1_EEG_elist_be_ar.set</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">EEG = pop_loadset( </span><span style="font-size:11.0pt; color:#A020F0; ">'filename'</span><span style="font-size:11.0pt; color:black; ">, </span><span style="font-size:11.0pt; color:#A020F0; ">'S1_EEG_elist_be_ar.set'</span><span style="font-size:11.0pt; color:black; ">, </span><span style="font-size:11.0pt; color:#A020F0; ">'filepath'</span><span style="font-size:11.0pt; color:black; ">,</span><span style="font-size:11.0pt; color:black; ">    </span><span style="font-size:11.0pt; color:#A020F0; ">'/Users/etfoo/Desktop/tutorial_script/'</span><span style="font-size:11.0pt; color:black; ">);</span><span style="font-size:11.0pt; color:black; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%The following command uses Matlab's <em>Current Folder</em></span><em><span style="font-size:11.0pt; color:forestgreen; "> </span></em></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">EEG = pop_loadset( </span><span style="font-size:11.0pt; color:#A020F0; ">'filename'</span><span style="font-size:11.0pt; color:black; ">, </span><span style="font-size:11.0pt; color:#A020F0; ">'S1_EEG_elist_be_ar.set'</span><span style="font-size:11.0pt; color:black; ">);</span><span style="font-size:11.0pt; color:black; "> </span></p>
</div>
<p class="paragraph">&nbsp;</p>
<p class="paragraph">Now select <strong>ERPLAB &gt; Compute Averaged ERP</strong>.  This will bring up the very simple window shown below.  You will normally average the data in the currently dataset, which is listed by default in the <strong>Dataset(s)</strong> field. If you want, you can specify multiple datasets and average across them as if all the epochs were stored in a single dataset.  Here we will just average the epochs from one dataset, so click <strong>RUN</strong> to start the averaging process. </p>
<p><img src="images/averaging.jpg" alt="averaging" width="512" height="216" /></p>
<p class="paragraph"><em>Hint: If you have a lot of channels or a high sampling rate (or both), you may find that the datasets are so large that Matlab becomes very slow (this is because only so much data can be stored in RAM, and Matlab may start storing some of the data in cache on your hard drive, which is very slow).  In this case, you may wish to keep each trial block in a separate dataset and combine them into a single ERPset during averaging.</em></p>
<p class="paragraph">Normally you will want to exclude epochs marked as containing artifacts (marked with artifact flag 1 in the EventList), which can be achieved by selecting &quot;Exclude epochs marked during artifact rejection.&quot;  If you want to include all epochs (ignoring the artifact flags), you can instead select &quot;Include ALL epochs.&quot;  It is also possible to include <em>only</em> the epochs that contain artifacts, excluding epochs without artifacts, by selecting &quot;Include ONLY epochs marked during artifact detection.&quot;  (This is uncommon, but you might do this to see the effects that the artifacts have on the data.) </p>
<div style="border:double windowtext 3.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;">
  <p class="paragraph" style="border:none;padding:0in;"><strong><span style="font-size:12.0pt; ">Equivalent Script Command:</span></strong></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Compute Averaged ERP </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%To average the data from dataset 5, whether or not it is selected, use the following:</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">ERP = pop_averager( ALLEEG , <span style="font-size:11.0pt; color:#A020F0; ">
'Criterion'</span>,1,<span style="font-size:11.0pt; color:#A020F0; ">
 'DSindex'</span>, 5, <span style="font-size:11.0pt; color:#A020F0; ">
'Stdev'</span>,<span style="font-size:11.0pt; color:#A020F0; ">
 'on' </span>); </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%To average the data from datasets 3-5, use the following:</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">ERP = pop_averager( ALLEEG , <span style="font-size:11.0pt; color:#A020F0; ">
'Criterion' </span>,1, <span style="font-size:11.0pt; color:#A020F0; ">
'DSindex' </span>, 3:5, <span style="font-size:11.0pt; color:#A020F0; ">
'Stdev'</span>, <span style="font-size:11.0pt; color:#A020F0; ">
'on'</span> ); </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%In all of these examples, the second-to-last argument specifies how artifacts should be treated:</span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%             1 – Exclude trials with artifacts (as in these examples)</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%             0 – Include all trials (ignore artifact flags)</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%             2 – Include ONLY trials with artifacts</span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%The last argument (0) is used to specify weighted versus unweighted averaging – it should ALWAYS be set to 0.</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; ">&nbsp;</span></p>
</div>
<p class="paragraph">&nbsp;</p>
<p class="paragraph">The averaging routine will print some useful information in the Matlab command window, as shown in the screenshot below.  Specifically, it will show the percentage of trials that were excluded because of artifacts and because of invalid trials (e.g., epochs with <strong>boundary</strong> events within them; invalid trials should be rare).  This information is provided both collapsed across bins and separately for each bin. </p>
<p><img src="images/average_output.jpg" alt="average_output" width="722" height="242" /></p>
<p class="paragraph">When the averaging routine is finished, it will display the window shown below, which allows you to name and save the ERPset that was created.  This window is shown every time an ERPLAB function modifies or creates an ERPset.  If one or more ERPsets were already loaded, you would have the option of overwriting the previously active ERPset or creating a new ERPset (you will usually want to create a new one – ERPsets are usually much smaller than datasets, and you will not usually run out of RAM because of ERPsets).  In this case, however, no other ERPsets are present, so you will be creating a new ERPset.  You should name the ERPset &quot;S1_ERPs&quot;.  This is the name that will be shown in the ERPsets menu.  You will usually want to save the results of averaging in a file on disk, so select the <strong>Save ERP as</strong> button and give the file the same name as the ERPset name.  You can do this easily by clicking the <strong>same as erpname</strong> button.  The file will be saved in Matlab's current directory unless you either specify an alternative path or use the <strong>Browse</strong> button.  You can click the <strong>OK</strong> button once you have set up the window as shown in the screenshot below. </p>
<p><img src="images/save_erpset.jpg" alt="save_erpset" width="397" height="275" /></p>
<p class="paragraph">You can now see the newly created ERPset in the <strong>ERPsets</strong> menu, as shown in the screenshot below. </p>
<p><img src="images/erpsets.jpg" alt="erpsets" width="190" height="87" /></p>
<p class="paragraph">&nbsp;</p>
<div style="border:double windowtext 3.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;">
  <p class="paragraph" style="border:none;padding:0in;"><strong><span style="font-size:12.0pt; ">Equivalent Script Command:</span></strong></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Setname is S1_ERPs</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Filename is S1_ERPs.erp</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Path is /Users/etfoo/Desktop/tutorial_script/S1_ERPs.erp</span><span style="font-size:11.0pt; color:forestgreen; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Note that you will need to replace the path with the actual location in your file system</span><span style="font-size:11.0pt; color:forestgreen; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">ERP = pop_savemyerp(ERP, <span style="font-size:11.0pt; color:#A020F0; ">
'erpname'</span>, <span style="font-size:11.0pt; color:#A020F0; ">
'S1_ERPs.set'</span>,<span style="font-size:11.0pt; color:#A020F0; ">
 'filename'</span>, <span style="font-size:11.0pt; color:#A020F0; ">
'S1_ERPs.erp'</span>, <span style="font-size:11.0pt; color:#A020F0; ">
'pathname'</span>, <span style="font-size:11.0pt; color:#A020F0; ">
'/Users/etfoo/Desktop/tutorial_script/'</span>); </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%The following command uses Matlab's <em>Current Folder</em></span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; "> ERP = pop_savemyerp(ERP, <span style="font-size:11.0pt; color:#A020F0; ">
'erpname'</span>, <span style="font-size:11.0pt; color:#A020F0; ">
'S1_ERPs.set'</span>,<span style="font-size:11.0pt; color:#A020F0; ">
 'filename'</span>, <span style="font-size:11.0pt; color:#A020F0; ">
'S1_ERPs.erp'</span>); </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;">&nbsp;</p>
<p> </p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;">&nbsp;</p>
</div>
<p class="MsoNormal" style="text-autospace:none;"><span style="font-family:Courier; ">&nbsp;</span></p>
<p class="paragraph">&nbsp;</p>
<table width="100%" border="0">
  <tr>
    <td><a href="Artifact_Detection.html">&lt;&lt;Artifact Detection</a><a href="Create_Eventlist.html"></a></td>
    <td><a href="index.html">Table of Contents</a></td>
    <td><a href="Plotting.html">Plotting ERP Waveforms&gt;&gt;</a></td>
  </tr>
</table>
</body>
</html>
