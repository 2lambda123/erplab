<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Filtering EEG and ERPs</title>

<link href="styles/erplab.css" rel="stylesheet" type="text/css" />
<style type="text/css">
<!--
p.paragraph {
margin-top:0in;
margin-right:0in;
margin-bottom:8.0pt;
margin-left:0in;
font-size:11.0pt;
font-family:Cambria;
}
-->
</style>
<style type="text/css">
<!--
table.MsoNormalTable {
font-size:11.0pt;
font-family:Cambria;
}
p.MsoNormal {
margin:0in;
margin-bottom:.0001pt;
font-size:12.0pt;
font-family:Cambria;
}
-->
</style>
</head>

<body>
<p class="paragraph">ERPLAB contains a set of filters that can be applied to continuous EEG, to segmented EEG, and to averaged ERPs.  Separate routines are used for filtering EEG (<strong>ERPLAB &gt; Filter &amp; Frequency Tools &gt;  Filters for EEG data</strong>) and for filtering ERPs (<strong>ERPLAB &gt; Filter &amp; Frequency Tools &gt; Filters for ERP data</strong>).  The routines are nearly identical, except for a few options.  We will start by discussing the filtering of averaged ERPs.  Make sure that &quot;S1_ERPs&quot; is selected in the <strong>ERPsets</strong> menu, and then select <strong>ERPLAB &gt; Filter &amp; Frequency Tools &gt; Filters for ERP data</strong>. You will see a window similar to the screenshot below.  This window allows you to set various properties of the filter.  First, you can determine whether to apply a low-pass filter (filtering out high frequencies) and/or a high-pass filter (filtering out low frequencies).  For each of these, you can select the 50% amplitude cutoff point by typing a number in the corresponding text field or by adjusting the sliders.  You can also adjust the slope of the filter's roll-off in the <strong>Roll-off &amp; filter order</strong> panel in units of decibels per octave (<strong>dB/oct</strong>) or in units decibels per decade (<strong>dB/dec</strong>) or in terms of the filter's order (if you change one, the others will automatically change). </p>
<p class="paragraph">You can see the frequency response function of the resulting filter (the extent to which each frequency is passed by the filter) in the graph at the top of the window (assuming that the <strong>Plot</strong> panel is set to <strong>Frequency response</strong>).  Try playing around with the various filter parameters to see how it changes the frequency response function.</p>
<p class="paragraph">Three general classes of filters have been implemented.  First, <strong>IIR Butterworth</strong> is a digital implementation of the classic Butterworth filter.  The output of this filter feeds back into its input, making it an <em>infinite impulse response</em><strong> </strong>filter.  It filters the data in both directions, avoiding any phase shift.  Second, <strong>FIR</strong> is a <em>finite impulse response</em> filter that uses a sinc impulse response function.  This kind of filter can be very efficient but can produce artificial oscillations in the filtered data under some conditions.  We will eventually implement Gaussian impulse response functions but have not done so yet.  However, the sinc filter approximates a Gaussian when a relatively low filter order is used.  The third option is<strong> Parks McClellan Notch</strong>, which provides a notch filter (which attenuates one narrow range of frequencies and passes everything else).</p>
<p class="paragraph">Filters can dramatically distort your data, creating artificial peaks and oscillations (see Chapter 5 in <em>An Introduction to the Event-Related Potential Technique</em>).  To avoid these distortions, we recommend that you choose a high-pass cutoff of 0.1 Hz or lower and a low-pass cutoff of 20 Hz or higher unless you really know what you're doing.  We also recommend a roll-off slope of 12 dB/octave.  For an example of how severe filtering can lead to incorrect conclusions, see Yeung et al., 2007, <em>Psychophysiology</em>, 44, 39-49. </p>
<p><img src="../Images/tutorial_Filtering_1.png" width="726" height="499" /></p>
<p class="paragraph">As an example, select <strong>ERPLAB &gt; Filter &amp; Frequency Tools &gt; Filters for ERP data</strong> and set up the filter as shown in the screenshot above, with no high-pass filter, a low-pass half-amplitude cutoff at 30 Hz, a roll-of of 12 dB/octave, a Butterworth filter type, and all 16 channels being filtered.  Click <strong>APPLY</strong>.  After the filtered data have been created, the standard window for saving new ERPsets will appear, and you should name the new ERPset &quot;S1_ERPs_30Hz&quot; (it's a good idea to save the ERPset to disk, because we will need this file for another example later).  This will now be the active ERPset.  If you plot it with<strong> ERPLAB &gt; Plot ERP Waveforms</strong>, the result will look like the following screenshots (you should also plot the unfiltered data for comparison).</p>
<p><img src="images/ploterps7.jpg" alt="ploterps7" width="700" height="670" border="1" /></p>
<div style="border:double windowtext 3.0pt;padding:1.0pt 4.0pt 0in 4.0pt;">
  <p class="paragraph" style="border:none;padding:0in;"><strong><span style="font-size:12.0pt; ">Equivalent Script Command:</span></strong></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Basic Filtering for ERP</span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Channels [1:16], High pass 0, Low pass 30, Order 2, IIR Butterworth</span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">ERP = pop_filterp( ERP,1:16, 0, 30, 2, </span><span style="font-size:11.0pt; color:#A020F0; ">'butter'</span><span style="font-size:11.0pt; color:black; ">, 0);</span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Setname is S1_ERPs_30Hz.set</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Filename is S1_ERPs_30Hz.erp</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Path is /Users/etfoo/Desktop/tutorial_script/S1_ERPs_30Hz.erp</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">ERP = pop_savemyerp(ERP, <span style="font-size:11.0pt; color:#A020F0; ">
'erpname'</span>, <span style="font-size:11.0pt; color:#A020F0; ">
'S1_ERPs_30Hz.set'</span>, <span style="font-size:11.0pt; color:#A020F0; ">
'filename'</span>,<span style="font-size:11.0pt; color:#A020F0; ">
 'S1_ERPs_30Hz.erp'</span>, <span style="font-size:11.0pt; color:#A020F0; ">
'pathname'</span>,<span style="font-size:11.0pt; color:#A020F0; ">
 '/Users/etfoo/Desktop/tutorial_script/'</span>,<span style="font-size:11.0pt; color:#A020F0; ">
 'warning'</span>,<span style="font-size:11.0pt; color:#A020F0; ">
 'on'</span>);</span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%The following command uses Matlab's <em>Current Folder</em></span><em><span style="font-size:11.0pt; color:forestgreen; "> </span></em></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">pop_savemyerp(ERP, </span><span style="font-size:11.0pt; color:#A020F0; ">'erpname'</span><span style="font-size:11.0pt; color:black; ">, </span><span style="font-size:11.0pt; color:#A020F0; ">'S1_ERPs_30Hz.set'</span><span style="font-size:11.0pt; color:black; ">, </span><span style="font-size:11.0pt; color:#A020F0; ">'filename'</span><span style="font-size:11.0pt; color:black; ">, </span><span style="font-size:11.0pt; color:#A020F0; ">' S1_ERPs_30Hz.erp'</span><span style="font-size:11.0pt; color:black; ">)</span><span style="font-size:11.0pt; "> </span></p>
</div>
<p class="paragraph">&nbsp;</p>
<p class="paragraph">Now let's try filtering continuous EEG data.  Make &quot;S1_Chan&quot; the active Dataset (loading it with <strong>File &gt; Load existing dataset</strong> if necessary).  Select <strong>ERPLAB &gt; Filter &amp; Frequency Tools &gt; Filters for EEG data</strong>.  Set the parameters as shown in the screenshot below, selecting a high-pass filter with a cutoff at 0.1 Hz and a low-pass filter with a cutoff at 30 Hz.  You should check the boxes for applying the filter to segments defined by boundary events (which you should always check unless you <em>really</em> know what you're doing) and for removing the mean value (which you should always do with DC recordings and which won't hurt for non-DC recordings).  The ERPLAB User's Manual provides more details. </p>
<p class="paragraph"><img src="../Images/tutorial_filtering_2.png" width="726" height="498" /></p>
<p class="paragraph">Once you've set the parameters, click <strong>APPLY</strong>.  The filtering will take a little while. Once it prints <strong>Done</strong> in the Matlab command window, use <strong>Plot &gt; Channel data (scroll)</strong> to see the filtered data, which should look like the screenshot below. </p>
<p><img src="images/eeg7.jpg" alt="eeg7" width="653" height="445" /></p>
<p class="paragraph"><em>Hint: In most cases, high-pass filters should be applied to the continuous EEG, not the epoched EEG or averaged ERPs.  The reason is that, with typical cutoff values, a long period of continuous data is needed for these filters to work properly.  Low-pass filters can be applied at any time, because they do not need a very long time period with typical settings.  In most cases, however, it is best to apply low-pass filtering after averaging.  Otherwise, you will need to back up to the EEG and repeat several steps if you later decide to change the filter settings.  However, low-pass filtering can sometimes improve artifact detection, in which case you can apply the low-pass filter to either the continuous or epoched EEG prior to artifact detection.</em></p>
<p class="paragraph">&nbsp;</p>
<div style="border:double windowtext 3.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;">
  <p class="paragraph" style="border:none;padding:0in;"><strong><span style="font-size:12.0pt; ">Equivalent Script Command:</span></strong></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Load S1_Chan from the current folder</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">EEG = pop_loadset( </span><span style="font-size:11.0pt; color:#A020F0; ">'filename'</span><span style="font-size:11.0pt; color:black; ">, </span><span style="font-size:11.0pt; color:#A020F0; ">'S1_Chan.set'</span><span style="font-size:11.0pt; color:black; ">);</span><span style="font-size:11.0pt; color:black; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Basic Filtering for EEG with High pass</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Channels 1:16, High-Pass 0.1, Low-Pass 30, Order 2, </span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%IIR Butterworth, Apply filter to segments defined by boundary events</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:forestgreen; ">%Boundary event code 'boundary'</span><span style="font-size:11.0pt; "> </span></p>
  <p class="MsoNormal" style="text-autospace:none;border:none;padding:0in;"><span style="font-size:11.0pt; color:black; ">EEG = pop_basicfilter( EEG,  1:16, 0.1, 30, 2, </span><span style="font-size:11.0pt; color:#A020F0; ">'butter'</span><span style="font-size:11.0pt; color:black; ">, 1, </span><span style="font-size:11.0pt; color:#A020F0; ">'boundary'</span><span style="font-size:11.0pt; color:black; "> );</span><span style="font-size:11.0pt; "> </span></p>
</div>
<p class="paragraph">&nbsp;</p>
<table width="100%" border="0">
  <tr>
    <td><a href="Plotting.html">&lt;&lt;Plotting ERP Waveforms</a></td>
    <td><a href="index.html">Table of Contents</a></td>
    <td><a href="Bin_Operations.html">Bin Operations&gt;&gt;</a></td>
  </tr>
</table>
</body>
</html>
